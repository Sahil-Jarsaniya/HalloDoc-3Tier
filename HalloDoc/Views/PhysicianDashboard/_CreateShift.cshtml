@model CreateShift;
<div class="modal fade" id="CreateShiftModel" tabindex="-1" aria-labelledby="newReqModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #01bce9; color:white;">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Create Shift</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="dropdown">
                    <form id="CreateShiftForm">
                        <div class="col-12">
                            <select asp-for="Regionid" id="Regionid" class="form-select form-select mb-3 " aria-label="Large select example">
                                <option disabled>Select Region</option>
                                @foreach (var item in Model.Regions)
                                {
                                    <option value="@item.Regionid">@item.Name</option>
                                }
                            </select>
                            <span class="text-danger"></span>
                        </div>
                        <div class="row g-2">
                            <div class="col-12">
                                <div class="form-floating">
                                    <input asp-for="Startdate" type="date" min="@DateTime.Now.ToString("yyyy-MM-dd")" class="form-control" placeholder="">
                                    <label for="">ShiftDate</label>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-floating">
                                    <input asp-for="StartTime" id="StartTime" type="time" class="form-control" placeholder="">
                                    <label for="">start</label>
                                </div>
                                <span class="text-danger" asp-validation-for="StartTime"></span>
                            </div>
                            <div class="col-6">
                                <div class="form-floating">
                                    <input asp-for="EndTime" id="EndTime" type="time" class="form-control" placeholder="">
                                    <label for="">End</label>
                                </div>
                                <span class="text-danger" asp-validation-for="EndTime"></span>
                            </div>
                            <div class="col-12">
                                <span class="text-danger" id="timeError"></span>
                            </div>
                        </div>
                        <div class="row g-2 m-1">
                            <div class="col-12">
                                <div class="form-check form-switch">
                                    <input asp-for="Isrepeat" class="form-check-input" type="checkbox" role="slider" id="RepeatToggle">
                                    <label asp-for="Isrepeat" class="form-check-label" for="RepeatToggle">Repeat</label>
                                </div>
                            </div>
                        </div>
                        <div id="repeatDiv" class="d-none">
                            <h6>Repeat Days</h6>

                            <div class="row g-2">

                                <div class="col-4">

                                    <input class="DaysCheckbox" type="checkbox" id="1" name="1" value="1" />
                                    <label for="1">Every Monday</label>
                                </div>
                                <div class="col-4">
                                    <input class="DaysCheckbox" type="checkbox" id="2" name="2" value="2" />
                                    <label for="2">Every Tuesday</label>
                                </div>
                                <div class="col-4">
                                    <input class="DaysCheckbox" type="checkbox" id="3" name="3" value="3" />
                                    <label for="3">Every Wednesday</label>
                                </div>
                                <div class="col-4">
                                    <input class="DaysCheckbox" type="checkbox" id="4" name="4" value="4" />
                                    <label for="4">Every Thursday</label>
                                </div>
                                <div class="col-4">
                                    <input class="DaysCheckbox" type="checkbox" id="5" name="5" value="5" />
                                    <label for="5">Every Friday</label>
                                </div>
                                <div class="col-4">
                                    <input class="DaysCheckbox" type="checkbox" id="6" name="6" value="6" />
                                    <label for="6">Every Saturday</label>
                                </div>
                                <div class="col-4">
                                    <input class="DaysCheckbox" type="checkbox" id="7" name="7" value="7" />
                                    <label for="7">Every Sunday</label>
                                </div>
                                <div class="col-12">

                                    <select asp-for="Repeatupto" class="form-select form-select mb-3" aria-label="Large select example">
                                        <option value="">Repeat End</option>
                                        <option value="1">1-time</option>
                                        <option value="2">2-time</option>
                                        <option value="3">3-time</option>

                                    </select>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="SaveShiftBtn">Save</button>
                <button type="button" class="btn btn-outline-primary CloseModal" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<script>
    $("#RepeatToggle").click(function () {
        var b = $(this).prop('checked');
        if (b) {
            $("#repeatDiv").removeClass('d-none');
        }
        else {
            $("#repeatDiv").addClass('d-none');
        }
    })

    $("#StartTime").change(function () {
        var EndTime = $(this).val();
        var startTime = $("#EndTime").val();
        if (startTime <= EndTime) {
            $("#timeError").text("Select Proper Time!!");
            $("#SaveShiftBtn").attr('disabled', 'disabled');
            console.log("error")
        } else {
            console.log("error n")
            $("#SaveShiftBtn").removeAttr('disabled');
            $("#timeError").text("");
        }
    })
    $("#EndTime").change(function () {
        var EndTime = $(this).val();
        var startTime = $("#StartTime").val();
        if (startTime >= EndTime) {
            $("#timeError").text("Select Proper Time!!");
            $("#SaveShiftBtn").attr('disabled', 'disabled');
            console.log("error")
        } else {
            console.log("error n")
            $("#timeError").text("");
            $("#SaveShiftBtn").removeAttr('disabled');
        }
    })
    $(".RegionSelect").change(function () {
        var selectedRegion = $(this).val();

        if (selectedRegion == null || selectedRegion == 0) {
            document.getElementById("RegionSelect").nextElementSibling.textContent = "Select Region!!"
        } else {
            document.getElementById("RegionSelect").nextElementSibling.textContent = "";
        }
    });

        $("#SaveShiftBtn").click(function () {
        if ($("#RegionSelect").val() == null || $("#RegionSelect").val() != null) {
            document.getElementById("RegionSelect").nextElementSibling.textContent = "Select Region!!"
        }
        if ($("#RegionSelect").val() != null && $("#RegionSelect").val() != 0) {

            var selectedDays = [];
            $(".DaysCheckbox").each(function () {

                var checkboxdata = {
                    Id: parseInt($(this).attr('id')),
                    value: $(this).val(),
                    Checked: $(this).is(':checked')
                };

                selectedDays.push(checkboxdata);
            })

            var formdata = new FormData($("#CreateShiftForm")[0]);

            formdata.append('selectedDays', JSON.stringify(selectedDays));
            $.ajax({
                url: '/PhysicianDashboard/CreateShift',
                type: 'POST',
                data: formdata,
                processData: false,
                contentType: false,
                success: function () {
                    $("#CreateShiftModel").modal('toggle');
                    //location.reload();
                }
            })
        }
    })
</script>